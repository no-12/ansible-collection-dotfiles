export FZF_DEFAULT_OPTS="
--ansi
--height='80%'
--bind='alt-s:toggle-sort'
--bind='alt-p:toggle-preview'
--bind='alt-w:toggle-preview-wrap'
"

is_git_repo() {
    git rev-parse --is-inside-work-tree >/dev/null
}

gl() {
    is_git_repo || return 1
    git lg --color=always "$@" |
        fzf --no-multi --no-sort --reverse --tiebreak=index --preview="echo {} | grep -Eo '[a-f0-9]+' | head -1 | xargs -I% git show --color=always %" |
        grep -Eo '[a-f0-9]+' |
        head -1 |
        xargs -I% git show --color=always %
}

gcb() {
    is_git_repo || return 1
    git remote update origin --prune
    local branch
    branch=$(
        git branch --all --color=always -vv |
            grep -v HEAD |
            fzf --no-multi --reverse --preview="echo {} | awk -F'[* ]' '{print \$3}' | xargs -I$ git lg --color=always $" |
            awk -F'[* ]' '{print $3}'
    )
    if [[ $branch == remotes/* ]]; then
        git checkout --track "$branch"
    else
        git checkout "$branch"
    fi
}

if [[ -f /usr/share/fzf/completion.zsh ]]; then
    source /usr/share/fzf/completion.zsh
fi
if [[ -f /usr/share/fzf/key-bindings.zsh ]]; then
    source /usr/share/fzf/key-bindings.zsh
fi
